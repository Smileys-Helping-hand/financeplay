generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String        @id @default(cuid())
  email       String        @unique
  name        String?
  transactions Transaction[]
  goals        Goal[]
  gamification Gamification?
  bursaries    Bursary[]
  accounts     Account[]
  createdAt   DateTime      @default(now())
}

model Account {
  id          String        @id @default(cuid())
  user        User          @relation(fields: [userId], references: [id])
  userId      String
  name        String
  type        String        // wallet, bank, savings, investment
  balance     Float         @default(0)
  currency    String        @default("ZAR")
  color       String?       // for UI display
  icon        String?       // for UI display
  createdAt   DateTime      @default(now())
}

model Transaction {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  accountId   String?
  date        DateTime
  amount      Float
  category    String
  description String
  createdAt   DateTime @default(now())
}

model Goal {
  id            String   @id @default(cuid())
  user          User     @relation(fields: [userId], references: [id])
  userId        String
  name          String
  targetAmount  Float
  currentAmount Float    @default(0)
  deadline      DateTime
  priority      String   @default("medium")
  category      String?  // emergency, vacation, purchase, education, etc.
  autoSave      Boolean  @default(false)
  autoSaveAmount Float?
  createdAt     DateTime @default(now())
}

model Gamification {
  id      String @id @default(cuid())
  user    User   @relation(fields: [userId], references: [id])
  userId  String @unique
  level   Int    @default(1)
  xp      Int    @default(0)
  streak  Int    @default(0)
  persona String  @default("friendly")
  dailyChallenge String @default("Complete a no-spend day")
  badges  String @default("") // JSON string for SQLite compatibility
}

model Bursary {
  id              String   @id @default(cuid())
  user            User     @relation(fields: [userId], references: [id])
  userId          String
  provider        String
  monthlyAmount   Float
  nextPaymentDate DateTime
  notes           String?
}
